<input type="text" id="name" placeholder="이름">
<input type="text" id="code" placeholder="코드 (있으면)">
<button id="loginBtn">로그인 / 새 코드 발급</button>

<div id="tripPanel" style="display:none;">
  <input type="text" id="city">
  <input type="date" id="startDate">
  <input type="date" id="endDate">
  <button id="addTripBtn">등록 / 수정</button>
  <button id="getTripBtn">내 출장 조회</button>
  <div id="tripList"></div>
</div>

<script>
const WORKER_URL = 'https://curly-sun-6201.apineluk.workers.dev';
let userCode = localStorage.getItem('userCode');

document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('name').value.trim();
  const codeInput = document.getElementById('code').value.trim();
  if(codeInput){
    const res = await fetch(`${WORKER_URL}?action=login&code=${codeInput}`);
    const data = await res.json();
    if(data.success){
      userCode = codeInput;
      localStorage.setItem('userCode', userCode);
      document.getElementById('tripPanel').style.display='block';
      return;
    } else alert("등록되지 않은 코드");
  }
  const res2 = await fetch(WORKER_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:'registerCode', name})
  });
  const data2 = await res2.json();
  if(data2.success){
    userCode = data2.code;
    localStorage.setItem('userCode', userCode);
    alert(`새 코드 발급: ${userCode}`);
    document.getElementById('tripPanel').style.display='block';
  }
});

document.getElementById('addTripBtn').addEventListener('click', async ()=>{
  const city = document.getElementById('city').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  const res = await fetch(WORKER_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:'addTrip', code:userCode, city, startDate, endDate})
  });
  const data = await res.json();
  alert(data.message);
});

document.getElementById('getTripBtn').addEventListener('click', async ()=>{
  const res = await fetch(`${WORKER_URL}?action=getData&code=${userCode}`);
  const data = await res.json();
  document.getElementById('tripList').innerHTML = data.map(t=>`
    <div>${t.city} (${t.startDate} ~ ${t.endDate})</div>
  `).join('');
});
</script>
